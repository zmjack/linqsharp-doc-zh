import Alert from '../../components/alert'

# ç‰ˆæœ¬è®¡åˆ’ï¼šæœç´¢æ›´æ–°

<Alert type="note">
è®¡åˆ’äº 2023 å¹´ 12 æœˆ 31 æ—¥å‰æ›´æ–°ã€‚
</Alert>

### åŸæœç´¢è¯­æ³•

æ¡ˆä¾‹ï¼šæŸ¥è¯¢ **åˆ†ç±»åç§°**ã€åˆ†ç±»ä¸‹çš„ **äº§å“åç§°**ã€äº§å“ä¸‹çš„ **ä¾›åº”å•†å…¬å¸åç§°** åŒ…å« æŒ‡å®šå­—ç¬¦ä¸²ã€‚

è¡¨æ¨¡å‹ï¼š

```mermaid
classDiagram
class Category {
    + CategoryID int
    + CategoryName string
    + Description string
    ----
    + Products ICollection~Product~
}
class Product {
    + ProductID int
    + ProductName string
    + QuantityPerUnit string
    + Discontinued bool
    ----
    + SupplierLink Supplier
    + CategoryLink Category
    ----
    + OrderDetails ICollection~OrderDetail~
}
class Supplier {
    + SupplierID int
    + CompanyName string
    + ContactName string
    + ContactTitle string
    + Address string
    + City string
    + Region string
    + PostalCode string
    + Country string
    + Phone string
    + Fax string
    + HomePage string
    ----
    + Products ICollection~Product~
}
Category "1" --> "*" Product
Supplier "1" --> "*" Product
```

åŸè°ƒç”¨è¯­æ³•ï¼š

```csharp copy {5-6}
/* Old code */
from c in Categories.Search("a", c => new
{
    c.CategoryName,
    _0 = c.Products.Select(x => x.ProductName),
    _1 = c.Products.Select(x => x.SupplierLink.CompanyName),
})
select new
{
    c.CategoryName,
}
```

åŸè®¾è®¡æ–¹æ¡ˆæœ‰å¦‚ä¸‹ç¼ºç‚¹ï¼š

- **New Expression** è¦æ±‚æ¯ä¸ªå±æ€§å¿…é¡»ä½¿ç”¨åç§°ï¼ˆæˆ–éšå¼åç§°ï¼‰ã€‚ä¾‹å¦‚ï¼Œ**\_0** å’Œ **\_1**ã€‚
- æ¯æ¡è§„åˆ™è¿”å›å€¼å¿…é¡»æ˜¯ **æœ€å°å˜é‡** æˆ–è€… **æ•°ç»„**ï¼Œä¸æ”¯æŒ **new è¡¨è¾¾å¼**ï¼Œå¯¼è‡´ç”Ÿæˆçš„ **SQL** æœ‰ä¸€å®šç¨‹åº¦çš„å†—ä½™ã€‚

ä¸‹é¢æ˜¯ç”Ÿæˆçš„ **SQL** è°ƒç”¨ï¼Œç”±äºæ¯æ¡è§„åˆ™æ˜¯ç‹¬ç«‹å¤„ç†ï¼Œå› æ­¤ä¼šç”Ÿæˆå¤šä¸ª **EXISTS** éƒ¨åˆ†ï¼Œç„¶åä½¿ç”¨ **OR** è¿æ¥ã€‚

```sql {6-7,9-11}
/* Generated SQL */
SELECT `@`.`CategoryName`
FROM `@n.Categories` AS `@`
WHERE ((`@`.`CategoryName` LIKE '%a%') OR EXISTS (
    SELECT 1
    FROM `@n.Products` AS `@0`
    WHERE (`@`.`CategoryID` = `@0`.`CategoryID`) AND (`@0`.`ProductName` LIKE '%a%'))) OR EXISTS (
    SELECT 1
    FROM `@n.Products` AS `@1`
    LEFT JOIN `@n.Suppliers` AS `@2` ON `@1`.`SupplierID` = `@2`.`SupplierID`
    WHERE (`@`.`CategoryID` = `@1`.`CategoryID`) AND (`@2`.`CompanyName` IS NOT NULL AND (`@2`.`CompanyName` LIKE '%a%')))
```

<br/>

### é‡æ–°è®¾è®¡

ä¸ºäº†ä¼˜åŒ–ä»¥ä¸Šé—®é¢˜ï¼Œæˆ‘ä»¬å†³å®šï¼š

- ä½¿ç”¨ **Initializers è¯­æ³•** ä»£æ›¿ **New Expression è¯­æ³•** é‡æ–°è®¾è®¡è¯¥åŠŸèƒ½ã€‚
- è§„åˆ™è¿”å›å€¼å…è®¸ä½¿ç”¨ **New Expression** æ¥ä¼˜åŒ–ä»£ç è°ƒç”¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿç”Ÿæˆæ›´åˆç†çš„ **SQL** è°ƒç”¨ã€‚

ä½¿ç”¨ **LINQ** è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **let** è¯­å¥æ¥å®šä¹‰æŸ¥è¯¢é“¾ï¼Œä»¥æ›´å®¹æ˜“çš„æ–¹å¼æ¥ç¼–å†™ä»£ç ï¼š

```csharp copy {6-12}
/* LINQ code */
from c in Categories.Search("a", c => new SearchSelector
{
    c.CategoryName,
    
    from p in c.Products
    let s = p.SupplierLink
    select new
    {
        p.ProductName,
        s.CompanyName,
    },
})
select new
{
    c.CategoryName,
}
```

åŒä¹‰çš„ **Lambda** è°ƒç”¨ï¼š

```csharp copy {6-10}
/* Lambda code */
from c in Categories.Search("a", c => new SearchSelector
{
    c.CategoryName,
    
    c.Products.Select(p => new
    {
        p.ProductName,
        p.SupplierLink.CompanyName,
    })
})
select new
{
    c.CategoryName,
}
```

ç”Ÿæˆçš„ **SQL** è°ƒç”¨ï¼š

```sql {6-8}
/* Generated SQL */
SELECT `@`.`CategoryName`
FROM `@n.Categories` AS `@`
WHERE (`@`.`CategoryName` LIKE '%a%') OR EXISTS (
    SELECT 1
    FROM `@n.Products` AS `@0`
    LEFT JOIN `@n.Suppliers` AS `@1` ON `@0`.`SupplierID` = `@1`.`SupplierID`
    WHERE (`@`.`CategoryID` = `@0`.`CategoryID`) AND ((`@0`.`ProductName` LIKE '%a%') OR (`@1`.`CompanyName` LIKE '%a%')))
```

<br/>

### æœ€ä½³å®è·µ

å¦‚æœèƒ½å¤Ÿä½¿ç”¨ **å•ä¸ªè§„åˆ™**ï¼Œé‚£ä¹ˆå°±ä¸ä½¿ç”¨ **å¤šæ¡è§„åˆ™**ã€‚

ä¾‹å¦‚ï¼Œåœ¨ä¸Šè¿°æ¡ˆä¾‹ä¸­ï¼Œå¦‚æœä½¿ç”¨ **å¤šæ¡è§„åˆ™** å®ç°ï¼š

```csharp copy {4-5}
/* LINQ code */
from c in Categories.Search("a", c => new SearchSelector
{
    from p in c.Products select p.ProductName,				
    from p in c.Products select p.SupplierLink.CompanyName,
})
select new
{
    c.CategoryName,
}
```

é‚£ä¹ˆï¼Œç”Ÿæˆçš„ **SQL** è°ƒç”¨å°±ä¼šå˜ä¸ºï¼š

```sql {5-6,8-10}
SELECT `@`.`CategoryName`
FROM `@n.Categories` AS `@`
WHERE EXISTS (
    SELECT 1
    FROM `@n.Products` AS `@0`
    WHERE (`@`.`CategoryID` = `@0`.`CategoryID`) AND (`@0`.`ProductName` LIKE '%a%')) OR EXISTS (
    SELECT 1
    FROM `@n.Products` AS `@1`
    LEFT JOIN `@n.Suppliers` AS `@2` ON `@1`.`SupplierID` = `@2`.`SupplierID`
    WHERE (`@`.`CategoryID` = `@1`.`CategoryID`) AND (`@2`.`CompanyName` LIKE '%a%'))
```

æ¨èä½¿ç”¨ï¼š

```csharp copy {4-8}
/* LINQ code */
from c in Categories.Search("a", c => new SearchSelector
{
    from p in c.Products select new
    {
        p.ProductName,
        p.SupplierLink.CompanyName,
    },
})
select new
{
    c.CategoryName,
}
```

<br/>

### å¼€å‘è®¡åˆ’

å·²å®ç°çš„éƒ¨åˆ†ï¼š

- [x] åŸºç¡€è§£æ
- [x] å­—ç¬¦ä¸²åŒ¹é…ï¼šæˆ–è€…ã€‚

æˆ‘ä»¬è¿˜éœ€å®ç°ä»¥ä¸‹å†…å®¹ï¼š

- [ ] ä¸ºæŸ¥è¯¢é“¾æä¾› **å¤šå­—ç¬¦ä¸²æœç´¢**ã€‚
- [ ] æ›´å¤šçš„ å•å­—ç¬¦ä¸²åŒ¹é…æ¨¡å¼ï¼š**åŒ…å«** | **å…¨ç­‰**ã€‚
- [ ] æ›´å¤šçš„ å¤šå­—ç¬¦ä¸²åŒ¹é…æ¨¡å¼ï¼š**æˆ–è€…** | **å¹¶ä¸”**ã€‚

<br/>

```csharp {2}
/* LINQ code */
from c in Categories.Search("a", c => new SearchSelector(SearchMode.Contains)
{
    from p in c.Products select new
    {
        p.ProductName,
        p.SupplierLink.CompanyName,
    },
})
select new
{
    c.CategoryName,
}
```



<br/>

æœ‰æ›´å¤šæƒ³æ³•ï¼Ÿ

ğŸ‘‰ [New Issue Â· zmjack/LinqSharp (github.com)](https://github.com/zmjack/linqsharp/issues/new?labels=feedback)